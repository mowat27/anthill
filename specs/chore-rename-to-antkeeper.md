# chore: Rename anthill to antkeeper across codebase

- Package name `anthill` is taken on PyPI; rename to `antkeeper` everywhere.
- Preserve case: `anthill` -> `antkeeper`, `Anthill` -> `Antkeeper`, `ANTHILL` -> `ANTKEEPER`.
- Verify completeness with `rg -i --hidden anthill` returning zero matches (excluding `.git/` and `uv.lock`).

## Solution Design

This is a mechanical find-and-replace across three case variants. The changes span:

1. **Python package directory**: `src/anthill/` -> `src/antkeeper/`
2. **Package metadata**: `pyproject.toml` project name and script entry point
3. **Import statements**: All `from anthill.*` and `import anthill.*` in source and tests
4. **Environment variable**: `ANTHILL_AGENTS_FILE` -> `ANTKEEPER_AGENTS_FILE`
5. **Default state directory**: `.anthill/state/` -> `.antkeeper/state/`
6. **Gitignore entry**: `.anthill/` -> `.antkeeper/`
7. **CLI command name**: `anthill` -> `antkeeper` (entry point in pyproject.toml)
8. **Documentation and comments**: All prose references in README.md, CLAUDE.md, app_docs/, specs/, handlers.py, tests/__init__.py, tests/core/__init__.py
9. **Skill/config files**: `.claude/skills/design-expert/expertise.yaml`, `.claude/commands/specify.md`
10. **Justfile**: All `anthill` references in recipes
11. **Log format string**: `anthill.run.{run_id}` -> `antkeeper.run.{run_id}` in runner.py

BREAKING CHANGE: This is a full rename. No backwards compatibility shims. Old `anthill` imports, env vars, and directory paths will stop working.

## Relevant Files

### Source files (imports, module references, env vars, strings)
- `src/anthill/__init__.py` - package init, rename directory to `src/antkeeper/`
- `src/anthill/core/__init__.py` - core package init
- `src/anthill/core/domain.py` - may have module-level docstring
- `src/anthill/core/app.py` - `.anthill/state/` default, docstrings
- `src/anthill/core/runner.py` - `anthill.run.{run_id}` logger name
- `src/anthill/channels/__init__.py` - package init
- `src/anthill/channels/cli.py` - imports from anthill
- `src/anthill/channels/api.py` - imports from anthill
- `src/anthill/channels/slack.py` - imports from anthill
- `src/anthill/git/__init__.py` - package init
- `src/anthill/git/worktrees.py` - imports from anthill
- `src/anthill/helpers/__init__.py` - package init
- `src/anthill/llm/__init__.py` - package init
- `src/anthill/llm/claude_code.py` - imports from anthill
- `src/anthill/http/__init__.py` - imports from anthill
- `src/anthill/http/webhook.py` - imports from anthill
- `src/anthill/http/slack_events.py` - imports from anthill
- `src/anthill/cli.py` - `ANTHILL_AGENTS_FILE` env var, imports, CLI entry point
- `src/anthill/server.py` - `ANTHILL_AGENTS_FILE` env var, `anthill.server:app` uvicorn string, imports

### Test files
- `tests/__init__.py` - docstring references
- `tests/core/__init__.py` - docstring references
- `tests/conftest.py` - imports from anthill
- `tests/test_cli.py` - imports, CLI invocation strings
- `tests/test_server.py` - imports from anthill
- `tests/test_slack_server.py` - imports from anthill
- `tests/core/test_workflows.py` - imports from anthill
- `tests/core/test_logging.py` - imports, `.anthill/state/` assertion string
- `tests/core/test_state_persistence.py` - imports from anthill
- `tests/channels/test_cli_channel.py` - imports from anthill
- `tests/channels/test_api_channel.py` - imports from anthill
- `tests/channels/test_slack_channel.py` - imports from anthill
- `tests/llm/test_claude_code_agent.py` - imports from anthill
- `tests/git/test_worktree.py` - imports from anthill
- `tests/git/test_context.py` - imports from anthill
- `tests/helpers/test_extract_json.py` - imports from anthill

### Config and metadata
- `pyproject.toml` - package name, script entry point
- `justfile` - CLI command references
- `.gitignore` - `.anthill/` directory entry
- `handlers.py` - imports and docstring

### Documentation
- `README.md` - all prose, code examples, project structure
- `CLAUDE.md` - framework reference card
- `app_docs/README.md` - doc index
- `app_docs/testing_policy.md` - testing docs
- `app_docs/instrumentation.md` - instrumentation docs
- `app_docs/http_server.md` - HTTP server docs
- `app_docs/slack.md` - Slack docs

### Skill and command files
- `.claude/skills/design-expert/expertise.yaml` - 51 occurrences
- `.claude/commands/specify.md` - references anthill

### Spec files (historical, update for consistency)
- `specs/feature-api-channel.md`
- `specs/feature-add-claude-code.md`
- `specs/chore-framework-logging.md`
- `specs/feature-add-cli.md`
- `specs/patch-sdlc-workflow.md`
- `specs/feature-git-worktrees.md`
- `specs/patch-store-state.md`
- `specs/patch-prompt-file-option.md`
- `specs/feature-slack-integration.md`

### Files NOT to modify manually
- `.git/` - managed by git, will update automatically
- `uv.lock` - regenerated by `uv sync` after pyproject.toml change

## Workflow

### Step 1: Rename the Python package directory

- `mv src/anthill src/antkeeper`
- This is the foundational change; all import paths depend on it.

### Step 2: Update pyproject.toml

- Change `name = "anthill"` to `name = "antkeeper"`
- Change `anthill = "anthill.cli:main"` to `antkeeper = "antkeeper.cli:main"` in `[project.scripts]`

### Step 3: Find and replace all case variants in source files

Run case-preserving replacements across all files in `src/antkeeper/`:
- `anthill` -> `antkeeper` (lowercase: imports, module paths, strings)
- `Anthill` -> `Antkeeper` (title case: docstrings, comments)
- `ANTHILL` -> `ANTKEEPER` (upper case: env var `ANTHILL_AGENTS_FILE` -> `ANTKEEPER_AGENTS_FILE`)

Key changes to verify:
- `src/antkeeper/core/app.py`: default `state_dir=".antkeeper/state/"`
- `src/antkeeper/core/runner.py`: logger name `antkeeper.run.{run_id}`
- `src/antkeeper/cli.py`: env var `ANTKEEPER_AGENTS_FILE`, uvicorn target `antkeeper.server:app`
- `src/antkeeper/server.py`: env var `ANTKEEPER_AGENTS_FILE`, module docstring

### Step 4: Update all test files

Replace all three case variants in every file under `tests/`.

### Step 5: Update handlers.py

Replace all `from anthill.` imports with `from antkeeper.` and update docstring.

### Step 6: Update .gitignore

- Change `.anthill/` to `.antkeeper/`

### Step 7: Update justfile

- Replace all `anthill` with `antkeeper` in command invocations.

### Step 8: Update documentation files

Replace all three case variants in:
- `README.md`
- `CLAUDE.md`
- `app_docs/README.md`
- `app_docs/testing_policy.md`
- `app_docs/instrumentation.md`
- `app_docs/http_server.md`
- `app_docs/slack.md`

### Step 9: Update .claude skill and command files

Replace all three case variants in:
- `.claude/skills/design-expert/expertise.yaml`
- `.claude/commands/specify.md`

### Step 10: Update spec files

Replace all three case variants in all files under `specs/`.

### Step 11: Regenerate uv.lock

- Run `uv sync` to regenerate the lock file with the new package name.

### Step 12: Run validation commands

Run all validation commands to confirm zero errors and zero leftover references.

## Testing Strategy

### Unit Tests

No new tests are needed. All existing tests must pass after the rename. The test suite itself is being renamed (import paths change), which validates the rename is complete.

### Integration

The CLI entry point changes from `anthill` to `antkeeper`. Any tests that invoke the CLI binary name must be updated.

### Edge Cases

- `.anthill/state/` default string in `App.__init__` and its test assertion in `test_logging.py`
- `ANTHILL_AGENTS_FILE` env var in `cli.py`, `server.py`, and docs
- Logger name `anthill.run.{run_id}` in `runner.py`
- Uvicorn module string `anthill.server:app` in `cli.py`
- The `uv.lock` file must be regenerated, not manually edited

## Acceptance Criteria

- All `from anthill` imports changed to `from antkeeper`
- Package directory is `src/antkeeper/`
- `pyproject.toml` names the package `antkeeper` with entry point `antkeeper`
- Env var is `ANTKEEPER_AGENTS_FILE`
- Default state dir is `.antkeeper/state/`
- `.gitignore` references `.antkeeper/`
- `rg -i --hidden anthill` returns zero matches (excluding `.git/` internals and `uv.lock`)
- All tests pass
- Lint and typecheck pass

### Validation Commands

```bash
# Regenerate lock file
uv sync

# Run all quality checks
just

# Verify no anthill references remain (exclude git internals and lock file)
rg -i --hidden anthill --glob '!.git/**' --glob '!uv.lock'
```

IMPORTANT: If any of the checks above fail you must investigate and fix the error. It is not acceptable to simply explain away the problem. You must reach zero errors, zero warnings before you move on. This includes pre-existing issues and other issues that you don't think are related to this bugfix.

## Notes

- The `uv.lock` file will still contain `anthill` references from dependency resolution metadata until `uv sync` regenerates it. This is expected and should not be manually edited.
- The `.git/` directory will contain historical references to `anthill` in commit messages, reflog, etc. These are immutable history and should be ignored.
- The parent directory name (`precision-weave/anthill/`) is outside the scope of this rename â€” it is the repo directory, not the package.

## Report

Report the following on completion:
- Total files modified
- Total files renamed/moved (the `src/anthill` -> `src/antkeeper` directory)
- Tests passing count
- Lint and typecheck status
- Output of `rg -i --hidden anthill --glob '!.git/**' --glob '!uv.lock'` (should be empty)
